---
title: "eCOTS Demo 2022"
author: "Your name goes here!"
date: "Today's date goes here!"
format: pdf
editor: visual
---

# Demo

```{r}
#| label: load-pkgs
#| message: false
 
library(tidyverse)
library(tidymodels)
library(knitr)
library(openintro)
library(dplyr)
```

## Introduction

In today's workshop, we will explore how to use \texttt{tidymodels} framework to perform data wrangling and modeling the data. We will start with some exploratory data analysis (EDA), walk through how to create the key components of a predictive model (models, recipes, and workflows), and how to perform cross-validation. Throughout we will be using the \texttt{loans} dataset from the OpenIntro textbook\footnote{Diez, David M., Christopher D. Barr, and Mine Ã‡etinkaya-Rundel. 2019. OpenIntro statistics.}

## Exercise 0: Data Cleanup

We are going to do a preliminary cleaning step. Let's drop any unused levels.

```{r}
#| label: load-data
# add code here
```

## Exercise 1: Train-Test Data Split

Now using \texttt{tidymodels}, split the data into a training and test set with a 75%-25% split. Don't forget to set a seed!

```{r}
#| label: initial-split
# add code here
```

## Exercise 2: The Model

Write the model for predicting interest rate (`interest_rate`) from debt to income ratio (`debt_to_income`), the term of loan (`term`), the number of inquiries (credit checks) into the applicant's credit during the last 12 months (`inquiries_last_12m`), whether there are any bankruptcies listed in the public record for this applicant (`bankrupt`), and the type of application (`application_type`). The model should allow for the effect of to income ratio on interest rate to vary by application type.

## Exercise 3: EDA

Explore characteristics of the variables you'll use for the model using the training data only. Create both univariate and bivariate plots, and make sure to think about which plots are the most appropriate and effective given the data types.

```{r}
#| label: explore
# add code here
```

## Exercise 4: \texttt{tidymodels} Model

Specify a linear regression model. Call it `loans_spec`.

```{r}
#| label: specify-model
# add code here
```

## Exercise 5: \texttt{tidymodels} Recipe

-   Predict `interest_rate` from `debt_to_income`, `term`, `inquiries_last_12m`, `public_record_bankrupt`, and `application_type`.
-   Mean center `debt_to_income`.
-   Make `term` a factor.
-   Create a new variable: `bankrupt` that takes on the value "no" if `public_record_bankrupt` is 0 and the value "yes" if `public_record_bankrupt` is 1 or higher. Then, remove `public_record_bankrupt`.
-   Interact `application_type` with `debt_to_income`.
-   Create dummy variables where needed and drop any zero variance variables.

```{r}
#| label: create-recipe
# add code here
```


## Exercise 6: \texttt{tidymodels} Workflow

Create the workflow that brings together the model specification and recipe.

```{r}
#| label: create-wflow
#| # add code here
```

## Exercise 7: Cross-Validation and Summary

Conduct 10-fold cross validation.

```{r}
#| label: cv-tenfold
# add code here
```

Summarize metrics from your CV resamples.

```{r}
#| label: cv-summarize
# add code here
```

# Writing Exercise

In this exercise, we will synthesize our work above to create a reader-friendly version of our conclusions. In the classroom, these sorts of writing exercises appear throughout homework and lab assignments as well as exams. They give students an opportunity to demonstrate their understanding while gaining an appreciation that communication is a crucial part of using statistics.

## Exploratory Data Analysis

Using your plots above (along with any other metrics you compute), describe your initial findings about the training data. Discuss why we perform EDA only on the training data and not on the entire data set.

## Model and Model Fit

Although our primary aim is prediction and not inference, its good to check the model fit nonetheless to make sure nothing looks out of the ordinary. Create a neatly organized table of the model output, and describe your observations, such as which parameters are significant. Make sure to interpret some coefficients appropriately.


## Cross-Validation

Explain what 10-fold CV does, and why it's useful. Display a neat table with the outputs of your CV summary, and describe your observations. Make sure to discuss why we are focusing on R-squared and RMSE instead of adjusted R-squared, AIC, and BIC.





